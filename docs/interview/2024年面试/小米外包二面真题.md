# 先做一道算法题

算法题比较简单，直接从牛客上找的应该是。

# 介绍自己比较熟悉的项目，用到哪些技术，遇到哪些问题，解决方案？

就介绍自己比较熟悉的项目，项目的架构，技术栈，项目中遇到的问题，以及怎么解决的就好。根据自己的实际情况来就好

# 线程池执行的原理？

1. 提交任务

2. 判断核心线程数是否满了，如果核心线程数没满，创建核心线程执行任务；
3. 如果核心线程满了，判断任务队列是否满了，任务队列没满，任务加入队列；
4. 如果任务队列满了，判断是否达到了最大线程数，没有达到最大线程数，创建最大线程来执行任务。
5. 如果达到了最大线程数，则执行拒绝策略。

拒绝策略：

AbortPolicy：抛出 `RejectedExecutionException`来拒绝新任务的处理

CallerRunsPolicy：调用执行自己的线程运行任务，也就是直接在调用`execute`方法的线程中运行(`run`)被拒绝的任务，如果执行程序已关闭，则会丢弃该任务。因此这种策略会降低对于新任务提交速度，影响程序的整体性能。如果您的应用程序可以承受此延迟并且你要求任何一个任务请求都要被执行的话，你可以选择这个策略。

DiscardPolicy：不处理新任务，直接丢掉。

DiscardOldestPolicy：此策略将丢弃最早的未处理的任务请求。

# Redis分布式锁，Redisson分布式锁，看门狗机制？

Redis实现分布式锁是依赖于set NX EX，set if Not Exsist + Expire。如果key存在则不做操作，如果key不存在则加锁成功，并设置一个过期时间，防止死锁。

使用set NX可能存在任务执行比较慢，还没有执行完成，锁就到了过期时间释放了锁。这就引入了Redisson分布式锁。

Redisson分布式锁底层是依赖于Redis + Lua脚本实现的，使用Lua脚本主要是为了保证操作的原子性。Redisson内置了看门狗机制，Redisson有一个叫watch dog的东西，会定时默认每隔10s的执行查看任务是否执行完成（加锁的默认时间是30s），如果任务没有执行完，那么会给锁进行续期，过期时间延长到30s，避免了任务没有执行完成，锁到了过期时间，提前释放了锁。

# 项目中还用Redis做什么？Redis大key怎么处理？

Redis一般都会用来做缓存，缓存token，分布式session等数据，除了缓存Redis还有一些其他的作用。如下：

- 缓存：项目中用Redis存储token，标签映射，机型映射数据等。
- 队列：Redis的lpush和rpop，实现一个队列，存储一些用户事件数据，用来匹配调研数据。
- 分布式锁：项目中用过Redis的set NX EX做分布式锁。Redisson做分布式锁。
- 发布订阅：使用Redis的pub和sub实现发布订阅广播，来更新本地缓存数据。
- 布隆过滤器：使用`Redisson的redissonClient.getBloomFilter(this.bloomFilterConfig.getName())`实现布隆过滤器。
- 分布式限流：用Redis实现一个分布式限流。

# xxljob怎么配置的，怎么执行的？

集群部署，分片执行

# Nacos的客户端怎么感知配置更新的？怎么更新容器中的配置的Bean？@RefreshScope？事件回调机制？

客户端会轮询的向服务器发送一个长连接请求，这个长连接最多30s就会超时，服务端在收到客户端的请求会先判断当前是否有配置更新，有更新则立即返回。如果没有更新，服务端会将这个请求拿住 “hold” 29.5s加入队列，最后的0.5s在检测配置文件，无论有没有更新都会进行正常的返回，但是在等待的29.5s期间，如果有配置的更新可以提前结束并返回。

具体是怎么hold住29.5s的是依赖于http的长链接？

# 接口每隔几秒返回很慢怎么排查？垃圾回收机制？jdk8的默认收集器?

排查思路：

1. 查看日志，是否有错误日志，接口代码是否有问题，如果接入skywalking可以直接看下调用链路，在那个地方耗时比较久。
2. 查看sql是否有问题，sql是否有优化的空间，是否创建合理的索引，索引是否失效等。
3. 如果接口和sql，表结构都没啥问题，那就要看服务的监控了，JVM，CPU，内存，垃圾回收等指标。
4. 如果是每隔一段时间就会进行频繁的Minor CG或Full GC，那就要导出内存的快照文件和线程的堆栈信息进行分析。
5. 可以试着调大堆内存，调大新生代的内存大小。主要的思路就是尽量让对象在新生代就被回收掉，避免进行Full GC。

JDK8的默认垃圾收集器：新生代 Parallel Scavenge，老年代的收集器：Parallel Old。



# 打印线程堆栈信息？JVM参数？晋升老年代的阈值，怎么配置？

jstack打印线程堆栈信息

jmap导出内存文件

-XX:MaxTenuringThreshold配置晋升老年的年龄阈值。









